<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ú©Ø§Ù† ÛŒØ§ Ø®Ø§Ù†Ù‡ Ø¯Ø± Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø·Ø±Ø­ Ù¾Ù„Ø®Ù…Ø±ÛŒ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Turf.js -->
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

  <style>
    /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø§ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
    html, body { 
      margin: 0; 
      height: 100%; 
      font-family: 'Vazirmatn', 'Segoe UI', Tahoma, sans-serif; 
      overflow: hidden;
      background: #f5f5f5;
    }
    
    #map { 
      height: 100vh; 
      width: 100vw; 
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1;
    }
    
    /* Ø¬Ø¹Ø¨Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ØµÙ„ÛŒ */
    #mainPanel {
      position: absolute;
      top: 15px;
      right: 15px;
      left: 15px;
      background: rgba(255, 255, 255, 0.98);
      border-radius: 15px;
      box-shadow: 0 5px 25px rgba(0,0,0,0.2);
      z-index: 2000;
      overflow: hidden;
      transition: all 0.3s ease;
      border: 2px solid #0078ff;
      max-height: 95vh;
    }
    
    .panel-header {
      padding: 18px 20px;
      background: linear-gradient(135deg, #0078ff, #005fd4);
      color: white;
      text-align: center;
      position: relative;
    }
    
    .panel-header h3 {
      margin: 0;
      font-size: 17px;
      font-weight: bold;
    }
    
    .panel-content {
      padding: 20px;
      max-height: 60vh;
      overflow-y: auto;
    }
    
    /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ */
    .primary-btn { 
      margin-top: 10px;
      padding: 14px 20px; 
      border: none; 
      background: linear-gradient(135deg, #0078ff, #005fd4); 
      color: white; 
      border-radius: 10px; 
      cursor: pointer; 
      font-size: 16px; 
      font-weight: bold;
      width: 100%;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(0, 120, 255, 0.3);
    }
    
    .primary-btn:hover { 
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 120, 255, 0.4);
    }
    
    .primary-btn:active { 
      transform: translateY(0);
    }
    
    .primary-btn:disabled { 
      background: #cccccc; 
      cursor: not-allowed; 
      box-shadow: none;
    }
    
    /* Ø¯Ú©Ù…Ù‡ Ø«Ø§Ù†ÙˆÛŒ */
    .secondary-btn {
      margin-top: 10px;
      padding: 12px 18px;
      border: 1px solid #0078ff;
      background: white;
      color: #0078ff;
      border-radius: 10px;
      cursor: pointer;
      font-size: 15px;
      width: 100%;
      transition: all 0.3s;
    }
    
    .secondary-btn:hover {
      background: #f0f7ff;
    }
    
    /* Ù†ØªÛŒØ¬Ù‡ Ø¨Ø±Ø±Ø³ÛŒ */
    #resultContainer {
      margin-top: 15px;
      padding: 0;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #e0e0e0;
      background: white;
    }
    
    .result-header {
      padding: 15px;
      background: #f8f9fa;
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .result-content {
      padding: 20px;
      font-size: 15px;
      line-height: 1.7;
    }
    
    .result-footer {
      padding: 15px;
      background: #f8f9fa;
      border-top: 1px solid #e0e0e0;
      text-align: center;
    }
    
    /* Ø¯Ú©Ù…Ù‡ Ú©ÙˆÚ†Ú© Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† */
    .close-btn {
      background: #6c757d;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 6px 12px;
      font-size: 13px;
      cursor: pointer;
    }
    
    /* Ø¯Ú©Ù…Ù‡ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù†Ù‚Ø´Ù‡ */
    .view-map-btn {
      background: #28a745;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 15px;
      font-size: 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    /* Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙˆÙ‚Ø¹ÛŒØª */
    .location-info {
      background: #e8f4fd;
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
      border-right: 4px solid #0078ff;
    }
    
    /* Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ */
    .developer-info {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid #eee;
      font-size: 13px;
      color: #555;
      line-height: 1.6;
      background: #f9f9f9;
      padding: 15px;
      border-radius: 10px;
    }
    
    .developer-info a {
      color: #0078ff;
      text-decoration: none;
      margin: 0 5px;
    }
    
    .developer-info a:hover {
      text-decoration: underline;
    }
    
    /* Ù…Ø¯Ø§Ù„ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ */
    #introModal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 3000;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 15px;
    }
    
    .modal-content {
      background: white;
      padding: 25px;
      border-radius: 20px;
      max-width: 500px;
      width: 95%;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }
    
    /* Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ù†Ù‚Ø´Ù‡ */
    .leaflet-control { 
      z-index: 1000 !important; 
    }
    
    .leaflet-control-zoom {
      margin-top: 100px !important;
    }
    
    /* Ú©Ù„Ø§Ø³ hidden */
    .hidden { 
      display: none !important; 
    }
    
    /* Ø­Ø§Ù„Øª Ø¬Ù…Ø¹â€ŒØ´Ø¯Ù‡ */
    .collapsed {
      max-height: 70px !important;
      overflow: hidden;
    }
    
    .collapse-btn {
      position: absolute;
      left: 15px;
      top: 15px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    
    /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ú©Ù†Ø´â€ŒÚ¯Ø±Ø§ */
    @media (max-width: 768px) {
      #mainPanel {
        top: 10px;
        right: 10px;
        left: 10px;
      }
      
      .panel-header {
        padding: 15px;
      }
      
      .panel-header h3 {
        font-size: 15px;
      }
      
      .panel-content {
        padding: 15px;
        max-height: 50vh;
      }
      
      .primary-btn, .secondary-btn {
        padding: 12px 16px;
        font-size: 14px;
      }
      
      .result-content {
        padding: 15px;
        font-size: 14px;
      }
    }
    
    @media (max-width: 480px) {
      #mainPanel {
        top: 5px;
        right: 5px;
        left: 5px;
      }
      
      .developer-info {
        font-size: 12px;
      }
    }
    
    /* Ù†Ø´Ø§Ù†Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± */
    .user-marker {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ */
    .warning-box {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      color: #856404;
    }
    
    .danger-box {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      color: #721c24;
    }
    
    .success-box {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      color: #155724;
    }
    
    /* Ù„ÛŒØ³Øª */
    ul.fa-ul {
      padding-right: 20px;
    }
    
    ul.fa-ul li {
      margin-bottom: 10px;
      position: relative;
      padding-right: 25px;
    }
    
    ul.fa-ul li:before {
      content: "â€¢";
      color: #0078ff;
      font-weight: bold;
      position: absolute;
      right: 0;
    }
  </style>
  
  <!-- ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ -->
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
  
  <!-- Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
<div id="map"></div>

<!-- Ù…Ø¯Ø§Ù„ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ -->
<div id="introModal">
  <div class="modal-content">
    <h2 style="color: #0078ff; text-align: center; margin-bottom: 20px;">
      <i class="fas fa-map-marked-alt"></i> Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¨Ø±Ù†Ø§Ù…Ù‡
    </h2>
    
    <div class="warning-box">
      <i class="fas fa-exclamation-triangle"></i> 
      <strong>ØªÙˆØ¬Ù‡ Ù…Ù‡Ù…:</strong> Ø§ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ <strong>Ø§Ø·Ù„Ø§Ø¹ Ø§ÙˆÙ„ÛŒÙ‡</strong> Ø§Ø³Øª Ùˆ Ù†ØªØ§ÛŒØ¬ Ø¢Ù† <strong>Ø§Ø­ØªÙ…Ø§Ù„ÛŒ</strong> Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯.
    </div>
    
    <h3><i class="fas fa-bullseye"></i> Ù‡Ø¯Ù Ø§ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡:</h3>
    <p><strong>Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ú©Ø§Ù† ÛŒØ§ Ø®Ø§Ù†Ù‡ Ø´Ù…Ø§ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ù‡Ø§ÛŒ Ø·Ø±Ø­ ØªÙˆØ³Ø¹Ù‡ Ø´Ù‡Ø±ÛŒ Ù¾Ù„Ø®Ù…Ø±ÛŒ</strong></p>
    
    <h3><i class="fas fa-info-circle"></i> Ù†Ú©Ø§Øª Ù…Ù‡Ù…:</h3>
    <ul class="fa-ul">
      <li>Ù†ØªØ§ÛŒØ¬ Ø§Ø±Ø§Ø¦Ù‡ Ø´Ø¯Ù‡ <strong>ØªØ£ÛŒÛŒØ¯ Ù†Ù‡Ø§ÛŒÛŒ</strong> Ù†ÛŒØ³Øª</li>
      <li>Ø¨Ø±Ø§ÛŒ ØªØµÙ…ÛŒÙ…â€ŒÚ¯ÛŒØ±ÛŒ Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø§ÛŒØ¯ Ø¨Ø§ <strong>Ø§Ù†Ø¬Ù†ÛŒØ±Ø§Ù† Ø´Ù‡Ø±Ø³Ø§Ø²ÛŒ Ùˆ Ø´Ø§ÙˆØ±Ø§Ù„ÛŒ</strong> Ù…Ø´ÙˆØ±Øª Ú©Ù†ÛŒØ¯</li>
      <li>Ù…ÙˆÙ‚Ø¹ÛŒØª Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø¨Ø§ GPS Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø´Ù…Ø§ ØªØ·Ø§Ø¨Ù‚ Ø¯Ø§Ø±Ø¯</li>
      <li>Ø¯Ù‚Øª Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ø¨Ù‡ Ø´Ø±Ø§ÛŒØ· Ù…Ø­ÛŒØ·ÛŒ Ø¨Ø³ØªÚ¯ÛŒ Ø¯Ø§Ø±Ø¯</li>
    </ul>
    
    <h3><i class="fas fa-play-circle"></i> Ú†Ú¯ÙˆÙ†Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒÙ…:</h3>
    <ol style="padding-right: 20px;">
      <li>Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ <strong>"Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ùˆ Ø¨Ø±Ø±Ø³ÛŒ"</strong> Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</li>
      <li>Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ø±Ø§ Ø¨Ø¯Ù‡ÛŒØ¯</li>
      <li>Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯</li>
      <li>Ù†ØªÛŒØ¬Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ø±Ø§ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯</li>
      <li>Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¯Ù† Ù†Ù‚Ø´Ù‡ Ú©Ø§Ù…Ù„ØŒ Ø±ÙˆÛŒ <strong>"Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù†Ù‚Ø´Ù‡"</strong> Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</li>
    </ol>
    
    <div class="danger-box">
      <i class="fas fa-hand-paper"></i>
      <strong>Ù‡Ø´Ø¯Ø§Ø±:</strong> Ø§ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù†Ø¬Ù†ÛŒØ±ÛŒ Ù†Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯!
    </div>
    
    <button class="primary-btn" id="closeModal">
      <i class="fas fa-play"></i> Ø´Ø±ÙˆØ¹ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¨Ø±Ù†Ø§Ù…Ù‡
    </button>
  </div>
</div>

<!-- Ù¾Ù†Ù„ Ø§ØµÙ„ÛŒ -->
<div id="mainPanel">
  <div class="panel-header">
    <button class="collapse-btn" id="togglePanel">
      <i class="fas fa-chevron-down"></i>
    </button>
    <h3>Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ú©Ø§Ù† ÛŒØ§ Ø®Ø§Ù†Ù‡ Ø¯Ø± Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø·Ø±Ø­ Ù¾Ù„Ø®Ù…Ø±ÛŒ</h3>
  </div>
  
  <div class="panel-content" id="panelContent">
    <p style="text-align: center; color: #555; margin-bottom: 20px;">
      <i class="fas fa-map-marker-alt"></i> Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ Ùˆ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø·Ø±Ø­ ØªÙˆØ³Ø¹Ù‡ Ø´Ù‡Ø±ÛŒ Ù…Ø·Ù„Ø¹ Ø´ÙˆÛŒØ¯
    </p>
    
    <div id="initialContent">
      <button class="primary-btn" id="checkBtn">
        <i class="fas fa-location-crosshairs"></i> Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ùˆ Ø¨Ø±Ø±Ø³ÛŒ
      </button>
      
      <button class="secondary-btn hidden" id="resetBtn">
        <i class="fas fa-redo"></i> Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¬Ø¯Ø¯
      </button>
      
      <div class="developer-info">
        <strong><i class="fas fa-user-tie"></i> Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ÙÙ†ÛŒ:</strong>
        <br><strong>Ø§Ù†ÛŒÙ„ Ù…Ø³Ø¹ÙˆØ¯ÛŒ</strong> (Anil Massoudi)
        <br><i class="fas fa-phone"></i> Ø´Ù…Ø§Ø±Ù‡â€ŒÙ‡Ø§ÛŒ ØªÙ…Ø§Ø³:
        <br><a href="tel:+93791898080">ğŸ“ 0791898080</a> | 
        <a href="tel:+93788658080">ğŸ“ 0788658080</a> | 
        <a href="tel:+93702658080">ğŸ“ 0702658080</a>
        <br>
        <i class="fab fa-facebook"></i> ÙÛŒØ³Ø¨ÙˆÚ©: 
        <a href="https://www.facebook.com/anil.masoudi99" target="_blank">facebook.com/anil.masoudi99</a>
        <br>
        <i class="fab fa-linkedin"></i> Ù„ÛŒÙ†Ú©Ø¯ÛŒÙ†: 
        <a href="https://www.linkedin.com/in/anil-massoudi-471896226/" target="_blank">linkedin.com/in/anil-massoudi</a>
      </div>
    </div>
    
    <!-- Ù†ØªÛŒØ¬Ù‡ Ø¨Ø±Ø±Ø³ÛŒ -->
    <div id="resultContainer" class="hidden">
      <div class="result-header">
        <strong><i class="fas fa-search-location"></i> Ù†ØªÛŒØ¬Ù‡ Ø¨Ø±Ø±Ø³ÛŒ</strong>
        <button class="close-btn" id="closeResult">
          <i class="fas fa-times"></i> Ø¨Ø³ØªÙ†
        </button>
      </div>
      <div class="result-content" id="resultContent">
        <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ù†ØªÛŒØ¬Ù‡ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯ -->
      </div>
      <div class="result-footer">
        <button class="view-map-btn" id="viewMapBtn">
          <i class="fas fa-map"></i> Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø§Ù…Ù„ Ù†Ù‚Ø´Ù‡
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  // =========================
  // 1. Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¯Ø§Ù„ Ø§ÙˆÙ„ÛŒÙ‡
  // =========================
  const introModal = document.getElementById('introModal');
  const closeModalBtn = document.getElementById('closeModal');
  
  window.addEventListener('load', function() {
    setTimeout(() => {
      introModal.style.display = 'flex';
    }, 500);
  });
  
  closeModalBtn.addEventListener('click', function() {
    introModal.style.display = 'none';
  });
  
  introModal.addEventListener('click', function(e) {
    if (e.target === introModal) {
      introModal.style.display = 'none';
    }
  });

  // =========================
  // 2. Ø³Ø§Ø®Øª Ù†Ù‚Ø´Ù‡
  // =========================
  const map = L.map('map').setView([36.2, 68.7], 14); // Ù…Ø®ØªØµØ§Øª Ù¾Ù„Ø®Ù…Ø±ÛŒ

  // Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡
  const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap',
    maxZoom: 19
  });
  
  const satelliteLayer = L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
    subdomains: ['mt0','mt1','mt2','mt3'],
    attribution: 'Â© Google Satellite',
    maxZoom: 20
  });

  satelliteLayer.addTo(map);

  // Ú©Ù†ØªØ±Ù„ Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§
  const overlays = {};
  const baseLayers = {
    "Ù†Ù‚Ø´Ù‡ Ù…Ø§Ù‡ÙˆØ§Ø±Ù‡â€ŒØ§ÛŒ": satelliteLayer,
    "Ù†Ù‚Ø´Ù‡ Ù…Ø¹Ù…ÙˆÙ„ÛŒ": osmLayer
  };
  
  L.control.layers(baseLayers, overlays, { collapsed: true }).addTo(map);

  // =========================
  // 3. ØªØ¨Ø¯ÛŒÙ„ GeometryCollection â†’ FeatureCollection
  // =========================
  function geometryCollectionToFeatureCollection(gc) {
    return {
      type: "FeatureCollection",
      features: gc.geometries.map(g => ({
        type: "Feature",
        geometry: g,
        properties: {}
      }))
    };
  }

  // =========================
  // 4. Ù„ÙˆØ¯ GeoJSON Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
  // =========================
  let planAreaData = null;
  let targetAreaData = null;

  // Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø±Ù†Ú¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§
  const planAreaStyle = { 
    color: '#ff0000', 
    weight: 3, 
    fillColor: '#ff0000', 
    fillOpacity: 0.15,
    dashArray: '5, 5'
  };
  
  const targetAreaStyle = { 
    color: '#ff9900', 
    weight: 2, 
    fillColor: '#ff9900', 
    fillOpacity: 0.2,
    dashArray: '3, 3'
  };

  function loadGeoJSONLayer(url, layerName, style, dataStore) {
    fetch(url)
      .then(response => {
        if (!response.ok) {
          throw new Error(`Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ${layerName}`);
        }
        return response.json();
      })
      .then(data => {
        if (data.type === "GeometryCollection") {
          data = geometryCollectionToFeatureCollection(data);
        }
        
        const layer = L.geoJSON(data, { 
          style: style,
          onEachFeature: function(feature, layer) {
            layer.bindPopup(`<strong>${layerName}</strong><br>Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ù‚ÛŒÙ‚ Ø¨Ø§ Ø§Ø¯Ø§Ø±Ù‡ Ø´Ù‡Ø±Ø³Ø§Ø²ÛŒ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯`);
          }
        }).addTo(map);
        
        overlays[layerName] = layer;
        
        if (dataStore) {
          dataStore.data = data;
        }
        
        if (Object.keys(overlays).length === 2) {
          const bounds = L.latLngBounds();
          Object.values(overlays).forEach(layer => {
            if (layer.getBounds) {
              bounds.extend(layer.getBounds());
            }
          });
          if (bounds.isValid()) {
            map.fitBounds(bounds, { 
              padding: [100, 100],
              maxZoom: 15 
            });
          }
        }
      })
      .catch(error => {
        console.error(`Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ${url}:`, error);
      });
  }

  // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§
  loadGeoJSONLayer("plan area.geojson", "Ù…Ù†Ø·Ù‚Ù‡ Ø·Ø±Ø­ (Plan Area)", planAreaStyle, { data: planAreaData });
  loadGeoJSONLayer("target area 500m.geojson", "Ù…Ù†Ø·Ù‚Ù‡ Ù‡Ø¯Ù ÛµÛ°Û° Ù…ØªØ±ÛŒ", targetAreaStyle, { data: targetAreaData });

  // =========================
  // 5. Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ù†Ù„ Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
  // =========================
  const checkBtn = document.getElementById("checkBtn");
  const resetBtn = document.getElementById("resetBtn");
  const closeResultBtn = document.getElementById("closeResult");
  const viewMapBtn = document.getElementById("viewMapBtn");
  const togglePanelBtn = document.getElementById("togglePanel");
  const mainPanel = document.getElementById("mainPanel");
  const panelContent = document.getElementById("panelContent");
  const initialContent = document.getElementById("initialContent");
  const resultContainer = document.getElementById("resultContainer");
  const resultContent = document.getElementById("resultContent");
  
  let userMarker = null;
  let panelCollapsed = false;
  
  // Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø¯Ø±ÛŒ
  const messages = {
    targetArea: `
      <div class="danger-box">
        <i class="fas fa-exclamation-triangle"></i>
        <strong>Ù‡Ø´Ø¯Ø§Ø±: Ø§Ù…Ú©Ø§Ù† Ù‚Ø±Ø§Ø± Ú¯Ø±ÙØªÙ† Ø¯Ø± Ù…Ù†Ø·Ù‚Ù‡ Ù‡Ø¯Ù</strong>
      </div>
      
      <p>ØªØ­Ù„ÛŒÙ„ Ø§ÙˆÙ„ÛŒÙ‡ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ú©Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§ <strong>Ø§Ø­ØªÙ…Ø§Ù„Ø§Ù‹</strong> Ø¯Ø± Ù…Ù†Ø·Ù‚Ù‡ Ù‡Ø¯Ù ÛµÛ°Û° Ù…ØªØ±ÛŒ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯.</p>
      
      <div class="warning-box">
        <strong><i class="fas fa-tools"></i> ØªÙˆØµÛŒÙ‡ Ø§Ù†Ø¬Ù†ÛŒØ±ÛŒ:</strong>
        <ul class="fa-ul">
          <li>Ø¯Ú©Ø§Ù† ÛŒØ§ Ø®Ø§Ù†Ù‡ Ø´Ù…Ø§ Ù…Ù…Ú©Ù† Ø§Ø³Øª ØªØ­Øª ØªØ£Ø«ÛŒØ± Ø·Ø±Ø­ ØªÙˆØ³Ø¹Ù‡ Ù‚Ø±Ø§Ø± Ú¯ÛŒØ±Ø¯</li>
          <li>Ø§Ù…Ú©Ø§Ù† ØªØºÛŒÛŒØ±Ø§Øª Ø¯Ø± Ø¢ÛŒÙ†Ø¯Ù‡ Ù†Ø²Ø¯ÛŒÚ© ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯</li>
          <li>Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ù‚ÛŒÙ‚ Ø¨Ø§ Ø§Ù†Ø¬Ù†ÛŒØ±Ø§Ù† Ø´Ù‡Ø±Ø³Ø§Ø²ÛŒ Ù…Ø´ÙˆØ±Øª Ú©Ù†ÛŒØ¯</li>
        </ul>
      </div>
      
      <p><i class="fas fa-hand-point-right"></i> <strong>Ø§Ù‚Ø¯Ø§Ù… Ø¶Ø±ÙˆØ±ÛŒ:</strong> Ø¨Ø§ÛŒØ¯ Ø¨Ø§ Ø§Ø¯Ø§Ø±Ù‡ Ø´Ù‡Ø±Ø³Ø§Ø²ÛŒ Ù¾Ù„Ø®Ù…Ø±ÛŒ Ùˆ Ø§Ù†Ø¬Ù†ÛŒØ±Ø§Ù† Ù…Ø´Ø§ÙˆØ± ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.</p>
    `,
    
    planArea: `
      <div class="warning-box">
        <i class="fas fa-info-circle"></i>
        <strong>Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡: Ù…Ù†Ø·Ù‚Ù‡ Ø·Ø±Ø­ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯</strong>
      </div>
      
      <p>Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§ <strong>Ø§Ø­ØªÙ…Ø§Ù„Ø§Ù‹</strong> Ø¯Ø± Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø·Ø±Ø­ ØªÙˆØ³Ø¹Ù‡ Ù¾Ù„Ø®Ù…Ø±ÛŒ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯.</p>
      
      <div style="background: #e8f4fd; padding: 15px; border-radius: 10px; margin: 15px 0;">
        <strong><i class="fas fa-clipboard-list"></i> Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:</strong>
        <ul class="fa-ul">
          <li>Ø¢Ù…Ø§Ø¯Ú¯ÛŒ Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ±Ø§Øª Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø´Ø¯Ù‡ Ø´Ù‡Ø±ÛŒ</li>
          <li>Ù…Ø´Ø§ÙˆØ±Ù‡ Ø¨Ø§ Ø§Ù†Ø¬Ù†ÛŒØ±Ø§Ù† Ø´Ù‡Ø±Ø³Ø§Ø²ÛŒ Ùˆ Ø´Ø§ÙˆØ±Ø§Ù„ÛŒ</li>
          <li>Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø§Ø®Ø¨Ø§Ø± Ø±Ø³Ù…ÛŒ Ø§Ø² Ø´Ø§Ø±ÙˆØ§Ù„ÛŒ Ù¾Ù„Ø®Ù…Ø±ÛŒ</li>
          <li>Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¯Ø§Ø±Ú© Ù…Ù„Ú©ÛŒØª Ø¨Ø§ Ø§Ø¯Ø§Ø±Ù‡ Ø«Ø¨Øª</li>
        </ul>
      </div>
      
      <p><i class="fas fa-file-contract"></i> <strong>ØªÙˆØ¬Ù‡:</strong> ÙˆØ¶Ø¹ÛŒØª Ø¯Ù‚ÛŒÙ‚ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒØ¯Ø§Ù†ÛŒ Ø¯Ø§Ø±Ø¯.</p>
    `,
    
    outside: `
      <div class="success-box">
        <i class="fas fa-check-circle"></i>
        <strong>ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ: Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø·Ø±Ø­</strong>
      </div>
      
      <p>Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ­Ù„ÛŒÙ„ Ø§ÙˆÙ„ÛŒÙ‡ØŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø·Ø±Ø­ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
      
      <div style="background: #e8f4fd; padding: 15px; border-radius: 10px; margin: 15px 0;">
        <strong><i class="fas fa-thumbs-up"></i> ØªÙˆØµÛŒÙ‡:</strong>
        <ul class="fa-ul">
          <li>Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø§ Ù†Ù‚Ø´Ù‡ ØªØ·Ø¨ÛŒÙ‚ Ø¯Ù‡ÛŒØ¯</li>
          <li>Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ú©Ø§Ù…Ù„ØŒ ÙˆØ¶Ø¹ÛŒØª Ø±Ø³Ù…ÛŒ Ø±Ø§ Ø§Ø³ØªØ¹Ù„Ø§Ù… Ú©Ù†ÛŒØ¯</li>
          <li>ØªØºÛŒÛŒØ±Ø§Øª Ø§Ø­ØªÙ…Ø§Ù„ÛŒ Ø¢ØªÛŒ Ø±Ø§ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ù†Ù…Ø§ÛŒÛŒØ¯</li>
          <li>Ù…Ø¯Ø§Ø±Ú© Ù…Ù„Ú©ÛŒØª Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ² Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯</li>
        </ul>
      </div>
      
      <p><i class="fas fa-map-marked-alt"></i> Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ø´Ù…Ø§ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
    `
  };

  // =========================
  // 6. Ù…Ø¯ÛŒØ±ÛŒØª Ø¬Ù…Ø¹â€ŒØ´Ø¯Ù† Ù¾Ù†Ù„
  // =========================
  togglePanelBtn.addEventListener('click', function() {
    panelCollapsed = !panelCollapsed;
    
    if (panelCollapsed) {
      mainPanel.classList.add('collapsed');
      togglePanelBtn.innerHTML = '<i class="fas fa-chevron-up"></i>';
    } else {
      mainPanel.classList.remove('collapsed');
      togglePanelBtn.innerHTML = '<i class="fas fa-chevron-down"></i>';
    }
  });

  // =========================
  // 7. Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø±
  // =========================
  checkBtn.onclick = function() {
    if (!navigator.geolocation) {
      alert("Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ø±Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯");
      return;
    }

    checkBtn.disabled = true;
    checkBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª...';
    
    resultContent.innerHTML = `
      <div style="text-align: center; padding: 30px; color: #0078ff;">
        <i class="fas fa-compass fa-spin fa-2x"></i>
        <br><br>
        <strong>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª...</strong>
        <br>
        <small>Ù„Ø·ÙØ§Ù‹ Ú†Ù†Ø¯ Ù„Ø­Ø¸Ù‡ ØµØ¨Ø± Ú©Ù†ÛŒØ¯</small>
      </div>
    `;
    
    resultContainer.classList.remove('hidden');
    initialContent.classList.add('hidden');

    navigator.geolocation.getCurrentPosition(
      function(pos) {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;
        const accuracy = pos.coords.accuracy;
        const userPoint = turf.point([lng, lat]);

        // Ø­Ø°Ù Ù†Ø´Ø§Ù†Ú¯Ø± Ù‚Ø¨Ù„ÛŒ
        if (userMarker) {
          map.removeLayer(userMarker);
        }
        
        // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø§Ù†Ú¯Ø± Ø¬Ø¯ÛŒØ¯
        userMarker = L.marker([lat, lng], {
          icon: L.divIcon({
            className: 'user-marker',
            html: `
              <div style="
                background: linear-gradient(135deg, #0078ff, #005fd4);
                width: 32px;
                height: 32px;
                border-radius: 50%;
                border: 3px solid white;
                box-shadow: 0 0 20px rgba(0,0,0,0.6);
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: bold;
                font-size: 16px;
              "><i class="fas fa-map-marker-alt"></i></div>
            `,
            iconSize: [32, 32]
          })
        }).addTo(map)
          .bindPopup(`
            <div style="text-align: right;">
              <strong><i class="fas fa-user-circle"></i> Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§</strong>
              <br><br>
              <i class="fas fa-map-pin"></i> Ø¹Ø±Ø¶ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ: <strong>${lat.toFixed(6)}</strong>
              <br>
              <i class="fas fa-map-pin"></i> Ø·ÙˆÙ„ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ: <strong>${lng.toFixed(6)}</strong>
              <br>
              <i class="fas fa-bullseye"></i> Ø¯Ù‚Øª Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ: <strong>${accuracy ? Math.round(accuracy) + ' Ù…ØªØ±' : 'Ù†Ø§Ù…Ø´Ø®Øµ'}</strong>
              <br><br>
              <small><i class="fas fa-info-circle"></i> Ø§ÛŒÙ† Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¨Ø§ GPS Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø´Ù…Ø§ ØªØ·Ø§Ø¨Ù‚ Ø¯Ø§Ø±Ø¯</small>
            </div>
          `)
          .openPopup();
        
        // ØªÙ†Ø¸ÛŒÙ… Ù†Ù…Ø§ÛŒ Ù†Ù‚Ø´Ù‡
        map.setView([lat, lng], 17, {
          animate: true,
          duration: 1.5
        });

        // Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø±Ø±Ø³ÛŒ
        setTimeout(() => {
          try {
            // Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ø§ turf.js Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯
            // ÙØ¹Ù„Ø§Ù‹ Ù…Ù†Ø·Ù‚ Ù†Ù…ÙˆÙ†Ù‡:
            let inTargetArea = false;
            let inPlanArea = false;
            let message = "";
            
            // Ù…Ù†Ø·Ù‚ Ù†Ù…ÙˆÙ†Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾Ù„Ø®Ù…Ø±ÛŒ
            if (lat > 36.1 && lat < 36.3 && lng > 68.6 && lng < 68.8) {
              inTargetArea = true;
            } else if (lat > 36.15 && lat < 36.25 && lng > 68.65 && lng < 68.75) {
              inPlanArea = true;
            }

            // Ø§Ù†ØªØ®Ø§Ø¨ Ù¾ÛŒØ§Ù… Ù…Ù†Ø§Ø³Ø¨
            if (inTargetArea) {
              message = messages.targetArea;
            } else if (inPlanArea) {
              message = messages.planArea;
            } else {
              message = messages.outside;
            }

            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙˆÙ‚Ø¹ÛŒØª
            message += `
              <div class="location-info">
                <strong><i class="fas fa-map-marked-alt"></i> Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§:</strong>
                <br><br>
                <table style="width: 100%;">
                  <tr>
                    <td><i class="fas fa-map-pin"></i> Ø¹Ø±Ø¶ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ:</td>
                    <td><strong>${lat.toFixed(6)}</strong></td>
                  </tr>
                  <tr>
                    <td><i class="fas fa-map-pin"></i> Ø·ÙˆÙ„ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ:</td>
                    <td><strong>${lng.toFixed(6)}</strong></td>
                  </tr>
                  <tr>
                    <td><i class="fas fa-bullseye"></i> Ø¯Ù‚Øª Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ:</td>
                    <td><strong>${accuracy ? Math.round(accuracy) + ' Ù…ØªØ±' : 'Ù†Ø§Ù…Ø´Ø®Øµ'}</strong></td>
                  </tr>
                </table>
                <br>
                <div style="background: white; padding: 10px; border-radius: 8px;">
                  <i class="fas fa-eye"></i> <strong>Ù†Ú©ØªÙ‡:</strong> Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§ Ø¨Ø§ Ø¹Ù„Ø§Ù…Øª Ø¢Ø¨ÛŒ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ ØªØ·Ø¨ÛŒÙ‚ Ø¯Ù‚ÛŒÙ‚ØŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ Ø±Ø§ Ø¨Ø§ Ù…Ø­Ù„ ÙˆØ§Ù‚Ø¹ÛŒ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ú©Ù†ÛŒØ¯.
                </div>
              </div>
              
              <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; border-right: 3px solid #0078ff;">
                <strong><i class="fas fa-phone-volume"></i> Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ù‚Ø·Ø¹ÛŒ Ùˆ Ø±Ø³Ù…ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ø§Ø¯Ø§Ø±Ø§Øª ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯:</strong>
                <ul class="fa-ul">
                  <li>Ø§Ø¯Ø§Ø±Ù‡ Ø´Ù‡Ø±Ø³Ø§Ø²ÛŒ Ù¾Ù„Ø®Ù…Ø±ÛŒ</li>
                  <li>Ø§Ù†Ø¬Ù†ÛŒØ±Ø§Ù† Ù…Ø´Ø§ÙˆØ± Ø±Ø³Ù…ÛŒ Ø´Ù‡Ø±Ø³Ø§Ø²ÛŒ</li>
                  <li>Ø¯ÙØ§ØªØ± Ø®Ø¯Ù…Ø§Øª Ø´Ù‡Ø±ÛŒ Ø´Ø§Ø±ÙˆØ§Ù„ÛŒ</li>
                  <li>Ø§Ø¯Ø§Ø±Ù‡ Ø«Ø¨Øª Ø§Ø³Ù†Ø§Ø¯ Ùˆ Ø§Ù…Ù„Ø§Ú©</li>
                </ul>
                <br>
                <div class="danger-box" style="font-size: 13px;">
                  <i class="fas fa-exclamation-circle"></i> 
                  <strong>ØªÙˆØ¬Ù‡:</strong> Ø§ÛŒÙ† Ù†ØªÛŒØ¬Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ­Ù„ÛŒÙ„ Ø§ÙˆÙ„ÛŒÙ‡ Ø§Ø³Øª Ùˆ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ£ÛŒÛŒØ¯ Ú©Ø§Ø±Ø´Ù†Ø§Ø³ÛŒ Ø§Ù†Ø¬Ù†ÛŒØ±Ø§Ù† Ø¯Ø§Ø±Ø¯.
                </div>
              </div>
            `;
            
            resultContent.innerHTML = message;

          } catch (error) {
            console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª:", error);
            resultContent.innerHTML = `
              <div class="danger-box">
                <i class="fas fa-exclamation-circle"></i>
                <strong>Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª</strong>
                <p>Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ø§Ù…Ú©Ø§Ù† Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.</p>
              </div>
            `;
          }

          checkBtn.disabled = false;
          checkBtn.innerHTML = '<i class="fas fa-location-crosshairs"></i> Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ùˆ Ø¨Ø±Ø±Ø³ÛŒ';
          resetBtn.classList.remove('hidden');
        }, 1500);

      },
      function(err) {
        let errorMessage = "";
        switch(err.code) {
          case err.PERMISSION_DENIED:
            errorMessage = `
              <div class="danger-box">
                <i class="fas fa-ban"></i>
                <strong>Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±Ø¯ Ø´Ø¯</strong>
                <p>Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¨Ø§ÛŒØ¯ Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ø±Ø§ Ø¨Ø¯Ù‡ÛŒØ¯:</p>
                <ol>
                  <li>Ø±ÙˆÛŒ Ø¢ÛŒÚ©ÙˆÙ† Ù‚ÙÙ„ Ø¯Ø± Ù†ÙˆØ§Ø± Ø¢Ø¯Ø±Ø³ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</li>
                  <li>Ú¯Ø²ÛŒÙ†Ù‡ "Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ" Ø±Ø§ Ø±ÙˆÛŒ "Ø§Ø¬Ø§Ø²Ù‡" ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯</li>
                  <li>ØµÙØ­Ù‡ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯</li>
                </ol>
              </div>
            `;
            break;
          case err.POSITION_UNAVAILABLE:
            errorMessage = "ğŸ“ GPS Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø´Ù…Ø§ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¢Ù† Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯";
            break;
          case err.TIMEOUT:
            errorMessage = "â³ Ø²Ù…Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯";
            break;
          default:
            errorMessage = "âŒ Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª";
        }
        
        resultContent.innerHTML = errorMessage;
        checkBtn.disabled = false;
        checkBtn.innerHTML = '<i class="fas fa-location-crosshairs"></i> Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ùˆ Ø¨Ø±Ø±Ø³ÛŒ';
      },
      {
        enableHighAccuracy: true,
        timeout: 20000,
        maximumAge: 0
      }
    );
  };

  // =========================
  // 8. Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ØªÛŒØ¬Ù‡
  // =========================
  closeResultBtn.addEventListener('click', function() {
    resultContainer.classList.add('hidden');
    initialContent.classList.remove('hidden');
    resetBtn.classList.remove('hidden');
  });

  viewMapBtn.addEventListener('click', function() {
    // Ø¬Ù…Ø¹ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ØªØ± Ù†Ù‚Ø´Ù‡
    mainPanel.classList.add('collapsed');
    panelCollapsed = true;
    togglePanelBtn.innerHTML = '<i class="fas fa-chevron-up"></i>';
    
    // Ø¨Ø²Ø±Ú¯Ù†Ù…Ø§ÛŒÛŒ Ø±ÙˆÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø±
    if (userMarker) {
      map.setView(userMarker.getLatLng(), 17, {
        animate: true,
        duration: 1
      });
    }
  });

  // =========================
  // 9. Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ
  // =========================
  resetBtn.addEventListener('click', function() {
    if (userMarker) {
      map.removeLayer(userMarker);
      userMarker = null;
    }
    
    resultContainer.classList.add('hidden');
    initialContent.classList.remove('hidden');
    resetBtn.classList.add('hidden');
    
    // Ø¨Ø§Ø²Ú¯Ø´Øª Ù¾Ù†Ù„ Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒ
    mainPanel.classList.remove('collapsed');
    panelCollapsed = false;
    togglePanelBtn.innerHTML = '<i class="fas fa-chevron-down"></i>';
  });

  // =========================
  // 10. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„
  // =========================
  function adjustForMobile() {
    const isMobile = window.innerWidth <= 768;
    
    if (isMobile) {
      map.getContainer().style.height = '100vh';
      
      // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ
      document.querySelectorAll('.leaflet-control').forEach(control => {
        if (!control.classList.contains('leaflet-control-zoom')) {
          control.style.display = 'none';
        }
      });
    }
  }
  
  adjustForMobile();
  window.addEventListener('resize', adjustForMobile);
  
  // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø²ÙˆÙ… Ù†Ø§Ø®ÙˆØ§Ø³ØªÙ‡
  document.addEventListener('touchmove', function(e) {
    if (e.scale !== 1) {
      e.preventDefault();
    }
  }, { passive: false });
</script>
</body>
</html>